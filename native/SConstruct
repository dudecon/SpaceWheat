#!/usr/bin/env python
import os

# Get godot-cpp path
godot_cpp_path = os.environ.get('GODOT_CPP_PATH', '../../godot-cpp')

# Import godot-cpp environment
env = SConscript(godot_cpp_path + '/SConstruct')

# Add Eigen headers
env.Append(CPPPATH=['include'])

# C++17 for Eigen
if env['platform'] != 'windows':
    env.Append(CXXFLAGS=['-O3'])

# Source files
# Exclude GPU-accelerated and disabled classes
sources = Glob('src/*.cpp')
# Remove disabled native classes that cause WSL crashes
disabled = [
    # RE-ENABLED: liquid_neural_net.cpp - needed for phase-shadow LNN in lookahead engine
    # 'src/liquid_neural_net.cpp',
    'src/liquid_neural_net_native.cpp',      # GPU-accelerated LNN (not needed)
    'src/quantum_sparse_native.cpp',         # GPU sparse matrix
    'src/batched_bubble_renderer.cpp',       # GPU bubble rendering
    'src/quantum_solver_cpu_native.cpp',     # Unused native solver
    # RE-ENABLED: Pure CPU evolution engines + force graph (no GPU deps, just Eigen/STL)
    # 'src/quantum_evolution_engine.cpp',
    # 'src/multi_biome_lookahead_engine.cpp',
    # 'src/force_graph_engine.cpp',  # NEW: Native force graph calculations
]
for f in disabled:
    sources = [s for s in sources if not str(s).endswith(f)]

# Build shared library
library = env.SharedLibrary(
    'bin/libquantummatrix{}'.format(env['suffix']),
    source=sources
)

Default(library)
